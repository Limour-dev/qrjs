var _Mathlog=Math.log,_Mathfloor=Math.floor,_createClass=function(){function e(f,g){for(var j,h=0;h<g.length;h++)j=g[h],j.enumerable=j.enumerable||!1,j.configurable=!0,'value'in j&&(j.writable=!0),Object.defineProperty(f,j.key,j)}return function(f,g,h){return g&&e(f.prototype,g),h&&e(f,h),f}}();function _classCallCheck(e,f){if(!(e instanceof f))throw new TypeError('Cannot call a class as a function')}function _toConsumableArray(e){if(Array.isArray(e)){for(var f=0,g=Array(e.length);f<e.length;f++)g[f]=e[f];return g}return Array.from(e)}function seededRandom(e){var f=e||1337;return function(){var h=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,j=1<arguments.length&&void 0!==arguments[1]?arguments[1]:2147483647,l=1e4*Math.sin(f),m=l-_Mathfloor(l);return f=(_Mathfloor(25214903917*m)+11)%2147483647,_Mathfloor(m*(j-h+1)+h)}}function robustSolition(e){var f=Array(e).fill(0);f[0]=1/e;for(var w=1;w<e;w++)f[w]=1/(w*(w+1));var h=0.05,j=[].concat(_toConsumableArray(f)),l=0.05*_Mathlog(e/h)*Math.sqrt(e),m=Math.min(Math.max(Math.round(e/l),2),e);console.log('\u9884\u5904\u7406\u96C6\u671F\u671B\u5927\u5C0F',l,'\u5EA6\u6570\u4E0A\u9650',m);for(var n=Array(m).fill(0),w=0;w<m-1;w++)n[w]=l/((w+1)*e);n[m-1]=l*_Mathlog(l/h)/e;for(var w=0;w<m;w++)j[w]+=n[w];var o=j.reduce(function(w,y){return w+y},0),q=j.map(function(w){return w/o}),s=q.length-q.reverse().findIndex(function(w){return w>0.1/e});q.reverse();var t=q.slice(0,s),u=t.reduce(function(w,y){return w+y},0),v=0;return t.map(function(w){return v+=w/u,v.toFixed(8)})}function randChunkNums(e,f,g){var h=seededRandom(g),j=(h(0,2147483646)/2147483647).toFixed(8),l=f.findIndex(function(n){return n>=j})+1;e-=1;for(var m=new Set;m.size<l;)m.add(h(0,e));return Array.from(m)}function xor(e,f){return new Uint8Array(e.map(function(g,h){return g^f[h]}))}var Droplet=function(){function e(f,g,h,j,l){_classCallCheck(this,e),this.data=f,this.seed=g,this.numChunks=h,this.prob=j,this.padding=l}return _createClass(e,[{key:'chunkNums',value:function chunkNums(){return randChunkNums(this.numChunks,this.prob,this.seed)}},{key:'getStr',value:function getStr(){var f=btoa(String.fromCharCode.apply(null,new Uint8Array(this.data)));return this.seed+'|'+this.numChunks+'|'+this.padding+'|'+f}}]),e}(),Fountain=function(){function e(f){var g=1<arguments.length&&void 0!==arguments[1]?arguments[1]:32,h=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;_classCallCheck(this,e),this.data=new Uint8Array(f),this.chunkSize=g,this.numChunks=Math.ceil(f.length/g),this.seed=h,this.r=seededRandom(h),this.prob=robustSolition(this.numChunks),this.padding=this.numChunks*this.chunkSize-f.length;var j=new Uint8Array(this.numChunks*this.chunkSize);j.set(this.data),this.data=j}return _createClass(e,[{key:'droplet',value:function droplet(){if(this.updateSeed(),1<this.numChunks){var n=randChunkNums(this.numChunks,this.prob,this.seed),f=null,g=!0,h=!1,j=void 0;try{for(var m,o,l=n[Symbol.iterator]();!(g=(m=l.next()).done);g=!0)o=m.value,f=null==f?this.chunk(o):xor(f,this.chunk(o))}catch(o){h=!0,j=o}finally{try{!g&&l.return&&l.return()}finally{if(h)throw j}}}else var f=this.data;return new Droplet(f,this.seed,this.numChunks,this.prob,this.padding)}},{key:'chunk',value:function chunk(f){var g=this.chunkSize*f,h=this.chunkSize*(f+1);return this.data.slice(g,h)}},{key:'updateSeed',value:function updateSeed(){this.seed=this.r()}}]),e}();
testData=new Uint8Array([1,2,3,4,5,6,7,8,9,10]),fountain=new Fountain(testData,4);